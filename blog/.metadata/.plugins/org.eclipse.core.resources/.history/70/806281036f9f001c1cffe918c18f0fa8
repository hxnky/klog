package com.klog.service;

import java.io.UnsupportedEncodingException;

import javax.mail.MessagingException;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;
import javax.mail.internet.MimeMessage.RecipientType;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.stereotype.Service;

import com.klog.domain.MemberVO;

@Service
public class MailSenderService {

	@Autowired
	private JavaMailSender sender;
	
	public int memberVerify(MemberVO member) {
		
		int result = 1;
		
		MimeMessage message = sender.createMimeMessage();
		
		try {

			// ë©”ì¼ ì œëª©
			message.setSubject(member.getM_name() + "ë‹˜, KLOG ê°€ì…ì„ ì¶•í•˜ë“œë¦½ë‹ˆë‹¤ ğŸ‰ğŸ‰", "UTF-8");

			// ë©”ì¼ ë‚´ìš© ì»¨í…ì¸  html
			String html = "<div style='width:500px;'><h3>" + member.getEmail() + "ë‹˜, ì•ˆë…•í•˜ì„¸ìš”.</h3><br>";
			html += " <h1>Instagram ë¡œê·¸ì¸ê³¼ ê´€ë ¨í•˜ì—¬ ë¶ˆí¸ì„ ë¼ì³ë“œë ¤ ì£„ì†¡í•©ë‹ˆë‹¤. </h1><br>";
			html += "<h1>ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”? </h1><br>";
			html += "<h1>íšŒì›ë‹˜ì´ ë¡œê·¸ì¸í•œ ê²ƒì´ ë§ë‹¤ë©´ ì§€ê¸ˆ ë°”ë¡œ ê³„ì •ì— ë¡œê·¸ì¸í•˜ê±°ë‚˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</h1>";
			html += "<button style='width: 80%; height: 30px; margin-top: 10px; margin-bottom: 20px;";
			html +=  "margin-left: 40px; background-color: dodgerblue; border: none;border-radius: 5px'>";
			html += "<a href='http://localhost:8080/user/RePw?id="+member.getId()+"' style='font-weight: bold; color: white; '>" + member.getId() + "(ìœ¼)ë¡œ ë¡œê·¸ì¸</a></button><div>";
			html += "íšŒì›ë‹˜ì˜ Instagram ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œê³  ìˆê±°ë‚˜ ì´ ì´ë©”ì¼ì—ì„œ ë¡œê·¸ì¸ ë§í¬ë¥¼ í´ë¦­í•œ ì‚¬ëŒë§Œ íšŒì›ë‹˜ì˜ ê³„ì •ì— ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";

			// messageì— ë‚´ìš© ì ìš©
			message.setText(html, "utf-8", "html");

			// from ì„¤ì •
			message.setFrom(new InternetAddress("Instagram"));

			// to ì„¤ì •
			message.addRecipient(RecipientType.TO, new InternetAddress(member.getEmail(), member.getM_name() + " ë‹˜ ğŸ’›", "UTF-8"));

			// ë©”ì¼ ë°œì†¡
			sender.send(message);

		} catch (MessagingException e) {
			result = 0;
			e.printStackTrace();
		} catch (UnsupportedEncodingException e) {
			result = 0;
			e.printStackTrace();
		}
		
		return result;
	}

	public int PwSend(MemberVO member) {

		int result = 1;

		MimeMessage message = sender.createMimeMessage();

		try {

			// ë©”ì¼ ì œëª©
			message.setSubject(member.getEmail() + "ë‹˜, ë”ìš± ê°„í¸í•˜ê²Œ Instagramì— ë‹¤ì‹œ ë¡œê·¸ì¸í•´ë³´ì„¸ìš”", "UTF-8");

			// ë©”ì¼ ë‚´ìš© ì»¨í…ì¸  html
			String html = "<div style='width:500px;'><h3>" + member.getEmail() + "ë‹˜, ì•ˆë…•í•˜ì„¸ìš”.</h3><br>";
			html += " <h1>Instagram ë¡œê·¸ì¸ê³¼ ê´€ë ¨í•˜ì—¬ ë¶ˆí¸ì„ ë¼ì³ë“œë ¤ ì£„ì†¡í•©ë‹ˆë‹¤. </h1><br>";
			html += "<h1>ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠìœ¼ì…¨ë‚˜ìš”? </h1><br>";
			html += "<h1>íšŒì›ë‹˜ì´ ë¡œê·¸ì¸í•œ ê²ƒì´ ë§ë‹¤ë©´ ì§€ê¸ˆ ë°”ë¡œ ê³„ì •ì— ë¡œê·¸ì¸í•˜ê±°ë‚˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</h1>";
			html += "<button style='width: 80%; height: 30px; margin-top: 10px; margin-bottom: 20px;";
			html +=  "margin-left: 40px; background-color: dodgerblue; border: none;border-radius: 5px'>";
			html += "<a href='http://localhost:8080/user/RePw?id="+member.getEmail()+"' style='font-weight: bold; color: white; '>" + member.getEmail() + "(ìœ¼)ë¡œ ë¡œê·¸ì¸</a></button><div>";
			html += "íšŒì›ë‹˜ì˜ Instagram ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œê³  ìˆê±°ë‚˜ ì´ ì´ë©”ì¼ì—ì„œ ë¡œê·¸ì¸ ë§í¬ë¥¼ í´ë¦­í•œ ì‚¬ëŒë§Œ íšŒì›ë‹˜ì˜ ê³„ì •ì— ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";

			// messageì— ë‚´ìš© ì ìš©
			message.setText(html, "utf-8", "html");

			// from ì„¤ì •
			message.setFrom(new InternetAddress("Instagram"));

			// to ì„¤ì •
			message.addRecipient(RecipientType.TO, new InternetAddress(member.getEmail(), member.getEmail() + " ë‹˜ ğŸ’›", "UTF-8"));

			// ë©”ì¼ ë°œì†¡
			sender.send(message);

		} catch (MessagingException e) {
			result = 0;
			e.printStackTrace();
		} catch (UnsupportedEncodingException e) {
			result = 0;
			e.printStackTrace();
		}
		return result;

	}

}
